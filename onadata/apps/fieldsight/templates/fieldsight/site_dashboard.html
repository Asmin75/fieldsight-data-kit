{% extends "fieldsight/fieldsight_base.html" %}
{% load i18n staticfiles %}
{% load filters %}

{% block page-title %}{% trans 'Site Dashboard' %}{% endblock %}
{%block extracss %}

    <link rel="stylesheet" href="{% static 'css/leaflet.css' %}">
    <link rel="stylesheet" href="{% static 'css/MarkerCluster.css' %}">
    <link rel="stylesheet" href="{% static 'css/MarkerCluster.Default.css' %}">
{% endblock %}

{% block head %}
    <a class="btn btn-success btn-raised" href="{% url 'fieldsight:site-edit' obj.pk %}">{% trans 'Edit' %}</a>
    <a class="btn btn-success btn-raised" href="{% url 'forms:setup-site-stages' obj.pk %}">{% trans 'Set up Stages' %}</a>
    <!--<a class="btn btn-success btn-raised" href="{% url 'forms:site-forms' obj.pk %}">{% trans 'Forms' %}</a>-->
{% endblock %}
{% block content %}





	<div class="organization-detail-page">


        <div class="organization-short-detail">
                <div class="org-grg">
                    <div class="col-md-3">
                        <div class="org-logo">
                            <img src="{{ obj.logo.url }}" title="{{ obj.logo}}" />
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="abt-org">
                            <h3>{{ obj.name }}</h3>
                            <p class="address"><span><i class="fa fa-map-marker" aria-hidden="true"></i></span>{{ obj.address }}</p>
                            
                            <p class="contact"><span><i class="fa fa-phone" aria-hidden="true"></i></span>{{ obj.phone }}</p>
                            <p class="fax"><span><i class="fa fa-fax" aria-hidden="true"></i></span>{{ obj.fax }}</p>
                            <p class="website"><span></span>{{ obj.website }}</p>
							<p class="short-detail">{{ obj.description }}</p>
                            <p class="progress-of-site">{% trans 'Progress' %}:</p>
                            <div class="progress progress-striped active progress-sm">
                                <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" style="width: {{ obj.id }}%">
                                    <span class="sr-only">{{ obj.id }}% Complete</span>
                                    <span class="progress-bar-value">{{ obj.id }}%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="assign-form-to-site">
                                <a class="btn btn-primary btn-raised" href="{% url 'forms:site-stages' obj.pk %}">
                                    {% trans 'Setup Stages Data' %}

                            </a>    
                        </div>
                        <div class="assign-form-to-site">
                            <a class="btn btn-success btn-raised" href="{% url 'forms:site-forms' obj.pk %}">
                                Create New Survey
                            </a>    
                        </div>
                    </div>
                    <div class="clearfixx"></div>
                </div>

        </div>
        <div class="organization-long-detail">
        	<div class="col-md-6">
                <ul class="nav nav-tabs">
                  <li class="active"><a data-toggle="tab" href="#org-map">Map View</a></li>
                  <li><a data-toggle="tab" href="#org-people">People Involved</a></li>
                  <li><a data-toggle="tab" href="#org-about">About Site</a></li>
                  <li><a data-toggle="tab" href="#org-blueprint">Blueprint</a></li>
                </ul>

                <div class="tab-content">
                  <div id="org-map" class="tab-pane fade in active">
                     <div class="map-container-fieldsight">
                        <div id="map"></div>
                        <div class="popop-container">
                            <h3 class="popop-head"></h3>
                            <p class="address-popop"></p>
                            <p class="contact-popop">01-1234567</p>
                            <div class="popop-gallery">

                            </div>
                        </div>
                      </div>
                  </div>
                  
                  
                  <div id="org-people" class="tab-pane fade">
                     <div class="add-people">
                        <a class="add_org_people" title="Add organization Admin"href="{% url 'fieldsight:add_org_admin' pk=obj.id %}">
                         <span><i class="fa fa-plus" aria-hidden="true"></i> Add People</span>
                     </a>
                     </div>
                     <div class="org-site-list">

                        {% for role in peoples_involved %}

                        <a href="#">
                            <div class="org-site">
                                
                                <div class="col-md-10">
                                    <div class="detail-org">
                                        <h3 class="pople-Name-org">{{role.user.email}}</h3>
                                        <p class="address"><span><i class="fa fa-map-marker" aria-hidden="true"></i></span>{{ role.user.username }}</p>
                                        <p class="contact"><span><i class="fa fa-phone" aria-hidden="true"></i></span>{{ role.group.name }}</p>
                                    </div>
                                </div>
                                <div class="clearfixx"></div>
                            </div>
                        </a>
                        {% endfor %}
                     </div>
                  </div>
                  <div id="org-about" class="tab-pane fade">
                     <div class="about-organization">
                      <p>{{obj.public_desc}}</p>
                     </div>
                  </div>
                  <div id="org-blueprint" class="tab-pane fade">
                     <div class="about-organization-blueprint">
                      
                     </div>
                  </div>
                </div>    
            </div>
            <div class="col-md-6">
                <div class="outstanding-and-all">
                    <ul class="nav nav-tabs">
                      <li class="active"><a data-toggle="tab" href="#out-standing">Outstanding ({{outstanding|length}})</a></li>
                      <li><a data-toggle="tab" href="#out-reject">Rejected ({{rejected|length}})</a></li>
                      <li><a data-toggle="tab" href="#out-approved">Approved ({{approved|length}})</a></li>
                      <li><a data-toggle="tab" href="#out-flagged">Flagged ({{flagged|length}})</a></li>
                    </ul>

                    <div class="tab-content">
                      <div id="out-standing" class="tab-pane fade in active">
                        <div class="org-site-list">
                            <div class="form-list">
                                {% for form in outstanding %}
                                <a href="#">
                                    <div class="org-site">
                                        
                                        <div class="">
                                            <div class="detail-org">
                                                <h5 class="site-title-org">{{form.xf.title}}</h5>
                                                <p class="address"><span>Form type:</span>{{ form.form_type }}</p>
                                                <p class="contact"><span>created Date:</span>{{ form.date_created }}</p>
                                            </div>
                                        </div>
                                        <div class="clearfixx"></div>
                                    </div>
                                </a>
                                {% endfor %}
                            </div>
                        </div>
                      </div>
                      <div id="out-reject" class="tab-pane fade">
                        <div class="org-site-list">
                            <div class="form-list">
                                {% for form in rejected %}
                                <a href="#">
                                    <div class="org-site">
                                        
                                      <div class="">
                                            <div class="detail-org">
                                                <h5 class="site-title-org">{{form.xf.title}}</h5>
                                                <p class="address"><span>Form type:</span>{{ form.form_type }}</p>
                                                <p class="contact"><span>created Date:</span>{{ form.date_created }}</p>
                                            </div>
                                        </div>
                                        <div class="clearfixx"></div>
                                    </div>
                                </a>
                                 {% endfor %}

                            </div>
                        </div>
                      </div>
                      <div id="out-approved" class="tab-pane fade">
                        <div class="org-site-list">
                            <div class="form-list">
                               {% for form in approved %}
                                <a href="#">
                                    <div class="org-site">

                                      <div class="">
                                            <div class="detail-org">
                                                <h5 class="site-title-org">{{form.xf.title}}</h5>
                                                <p class="address"><span>Form type:</span>{{ form.form_type }}</p>
                                                <p class="contact"><span>created Date:</span>{{ form.date_created }}</p>
                                            </div>
                                        </div>
                                        <div class="clearfixx"></div>
                                    </div>
                                </a>
                                 {% endfor %}
                            </div>
                        </div>
                      </div>
                      <div id="out-flagged" class="tab-pane fade">
                        <div class="org-site-list">
                            <div class="form-list">
                                {% for form in flagged %}
                                <a href="#">
                                    <div class="org-site">

                                      <div class="">
                                            <div class="detail-org">
                                                <h5 class="site-title-org">{{form.xf.title}}</h5>
                                                <p class="address"><span>Form type:</span>{{ form.form_type }}</p>
                                                <p class="contact"><span>created Date:</span>{{ form.date_created }}</p>
                                            </div>
                                        </div>
                                        <div class="clearfixx"></div>
                                    </div>
                                </a>
                                 {% endfor %}
                            </div>
                        </div>
                      </div>
                    </div>  
                </div>  
            </div>
        </div>



    </div>

{% endblock %}





{% block all_flagged_forms %}
 <div class="row">

    <div class="col-md-3">
        <div class="mini-flagged-forms yellow-flagged">
            <div class="mini-stat-info">
                <span>{{flagged|length}}</span>
                Flagged forms
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="mini-flagged-forms green-flagged">
            <div class="mini-stat-info">
                <span>{{approved|length}}</span>
                Approved froms
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="mini-flagged-forms red-flagged">
            <div class="mini-stat-info">
                <span>{{rejected|length}}</span>
                Rejected forms
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="mini-flagged-forms purple-flagged">
            <div class="mini-stat-info">
                <span>{{outstanding|length}}</span>
                outstanding forms
            </div>
        </div>
    </div>


  </div>
{% endblock %}

{%block extrascript %}
    <script type="text/javascript" src="{{ STATIC_URL }}js/map/leaflet.js"></script>

    <script type="text/javascript" src="{{ STATIC_URL }}js/map/leaflet.ajax.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/map/textLabel.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/map/leaflet.markercluster-src.js"></script>

    <script src="http://maps.google.com/maps/api/js?v=3&key=AIzaSyC8uXN1u5FYIaGOUnVK90Rh3wR2Gmyw1uU"></script>

    <script type="text/javascript">
    $(document).ready(function(){
    console.log("inside ready");
    });
    var static_url ="{{ STATIC_URL }}";
    var data = {{ data|safe}};

    </script>
    <script type="text/javascript">

    function init(){
        // console.log("inside ready");
        var map = L.map("map", {
                center: [27.73672, 85.31942],
                zoom: 7
        });

        var osm = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'
        });

        googleStreets = L.tileLayer('http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}',{
            maxZoom: 20,
            subdomains:['mt0','mt1','mt2','mt3']
        });
        googleHybrid = L.tileLayer('http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}',{
            maxZoom: 20,
            subdomains:['mt0','mt1','mt2','mt3']
        });
        googleSat = L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}',{
            maxZoom: 20,
            subdomains:['mt0','mt1','mt2','mt3']
        });
        googleTerrain = L.tileLayer('http://{s}.google.com/vt/lyrs=p&x={x}&y={y}&z={z}',{
            maxZoom: 20,
            subdomains:['mt0','mt1','mt2','mt3']
        });

        var baseLayers = {
            "OpenStreetMap": osm,
            "Google Streets": googleStreets,
            "Google Hybrid": googleHybrid,
            "Google Satellite": googleSat,
            "Google Terrain": googleTerrain
        };

        map.addLayer(osm);
        layerswitcher = L.control.layers(baseLayers, {}, {collapsed: true}).addTo(map);
        var markers = L.markerClusterGroup();


        var geojson = {"type": "FeatureCollection", "crs": {"type": "name", "properties": {"name": "EPSG:4326"}}, "features": [{"geometry": {"type": "Point", "coordinates": [85.324, 27.7172]}, "type": "Feature", "properties": {"public_desc": "boarding", "name": "SChulla chulla bes", "address": "ktm"}}, {"geometry": {"type": "Point", "coordinates": [85.324, 27.7172]}, "type": "Feature", "properties": {"public_desc": "Hospital for public", "name": "Helping Hand", "address": "chabahel"}}, {"geometry": {"type": "Point", "coordinates": [85.324, 27.7172]}, "type": "Feature", "properties": {"public_desc": "naxa", "name": "Naxa site", "address": "nagpokhari"}}, {"geometry": {"type": "Point", "coordinates": [85.324, 27.7172]}, "type": "Feature", "properties": {"public_desc": "park", "name": "Park site", "address": "fasdf"}}, {"geometry": {"type": "Point", "coordinates": [85.324, 27.7172]}, "type": "Feature", "properties": {"public_desc": "fieldsight", "name": "fieldsight sight", "address": "kathmandu"}}]};



        geoJsonLayer = new L.geoJson(data, {
            pointToLayer: function(feature, latlng) {
                icon = L.icon({
                                //iconSize: [27, 27],
                                iconAnchor: [13, 27],
                                popupAnchor:  [1, -24],
                                iconUrl: './css/images/marker-icon.png'
                                });
                //console.log(icon.options);
                var marker = L.marker(latlng, {icon: icon});
                return marker;

            },
            onEachFeature: function(feature, layer) {
                layer.bindPopup(feature.properties.public_desc+'<br/>'+feature.properties.name+'<br/>'+feature.properties.address);

            }
        });

        markers.addLayer(geoJsonLayer);
        map.addLayer(markers);

        layerswitcher.addOverlay(markers, "Schools");

        markers.on('click',function(e){
            //console.log($('.item'));
            $('.popop-head').addClass('changed');
            $('.popop-head').html(e.layer.feature.properties.public_desc);
            $('.address-popop').html(e.layer.feature.properties.address);
            //$('.contact-popup').html(e.layer.feature.properties.contact);


        });

        map.on('click',function(){
            $('.popop-head').removeClass('changed');
            $('.popop-head').html('');
            $('.address-popop').html('');
            //$('.contact-popup').html('');
        });

    };
    </script>
{% endblock %}